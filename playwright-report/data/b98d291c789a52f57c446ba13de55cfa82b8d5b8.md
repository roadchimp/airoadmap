# Test info

- Name: Enterprise SaaS Inc. (ESI) AI Transformation Assessment >> Complete ESI assessment flow and verify AI transformation report
- Location: /Users/samsena/Documents/Repos/airoadmap/e2e/EnterpriseSaaS.spec.ts:144:3

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toBeVisible()

Locator: getByRole('heading', { name: 'Pre-Sales AI Transformation' })
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for getByRole('heading', { name: 'Pre-Sales AI Transformation' })

    at /Users/samsena/Documents/Repos/airoadmap/e2e/EnterpriseSaaS.spec.ts:784:105
```

# Page snapshot

```yaml
- link "AI Prioritize Transformation Tool":
  - /url: /dashboard
  - img
  - heading "AI Prioritize" [level=1]
  - paragraph: Transformation Tool
- navigation:
  - link "Dashboard":
    - /url: /dashboard
    - img
    - text: Dashboard
  - link "New Assessment":
    - /url: /assessment/new
    - img
    - text: New Assessment
  - link "Current Assessments":
    - /url: /assessment/current
    - img
    - text: Current Assessments
  - link "Previous Reports":
    - /url: /reports
    - img
    - text: Previous Reports
  - link "Libraries":
    - /url: /library
    - img
    - text: Libraries
  - link "Scoring Settings":
    - /url: /settings/scoring
    - img
    - text: Scoring Settings
  - link "Home":
    - /url: /
    - img
    - text: Home
- button "Collapse sidebar":
  - text: Hide Menu
  - img
- img
- paragraph: Consultant User
- paragraph: consultant@example.com
- button:
  - img
- banner:
  - heading "AI Transformation Assessment" [level=1]
  - button "Help":
    - img
    - text: Help
- main:
  - heading "AI Transformation Report" [level=1]
  - paragraph: Generated on 5/19/2025, 5:17:14 AM
  - button "Print/PDF":
    - img
    - text: Print/PDF
  - button "Export":
    - img
    - text: Export
  - text: "Assessment Context Assessment For: N/A Organization: Default Organization Industry: Software & Technology Industry Maturity: Mature Company Stage: Scaling Strategic Focus: Efficiency & Productivity, Cost Reduction, Revenue Growth, Operational Excellence"
  - tablist:
    - tab "Overview" [selected]
    - tab "Priority Matrix"
    - tab "Opportunities"
    - tab "Performance Metrics"
    - tab "AI Adoption Score"
  - tabpanel "Overview":
    - text: Executive Summary
    - paragraph: Generating report for Pre-Sales AI Transformation...
    - img
    - text: Expected Performance Impact
    - heading "$0" [level=3]
    - paragraph: Estimated Annual ROI
    - paragraph: Based on time savings and increased throughput
    - text: ðŸ“ˆ AI Adoption Score
    - img
    - text: "0"
    - paragraph: Click to view details
    - text: Consultant Commentary
    - button "Edit":
      - img
      - text: Edit
    - paragraph: No commentary has been added yet.
- alert
```

# Test source

```ts
  684 |       // Poll for either the "Generating report" message to disappear or URL to change
  685 |       while (Date.now() - pollingStartTime < maxWaitTimeMs) {
  686 |         // Log current status at regular intervals
  687 |         if ((Date.now() - pollingStartTime) % 10000 < 1000) { // Log roughly every 10 seconds
  688 |           console.log(`Still waiting for redirect... (${Math.floor((Date.now() - pollingStartTime)/1000)}s elapsed)`);
  689 |         }
  690 |         
  691 |         // Check if we've been redirected to a report page
  692 |         const currentUrl = page.url();
  693 |         if (new RegExp(`${APP_URL}/reports/\\d+$`).test(currentUrl)) {
  694 |           console.log(`Successfully redirected to: ${currentUrl} after ${Math.floor((Date.now() - pollingStartTime)/1000)}s`);
  695 |           redirectSuccess = true;
  696 |           break;
  697 |         }
  698 |        
  699 |         // Check if the generation message is gone (UI may have updated)
  700 |         const generatingVisible = await page.getByText(/Generating report|Processing/i).isVisible();
  701 |         const submitButtonVisible = await page.getByRole('button', { name: /generate report/i }).isVisible();
  702 |         
  703 |         if (!generatingVisible && submitButtonVisible) {
  704 |           // The message disappeared but we're still on the same page - might need to click again
  705 |           console.log("Generation message disappeared but no redirect occurred. Trying to click button again...");
  706 |           await page.getByRole('button', { name: /generate report/i }).click();
  707 |         }
  708 |         
  709 |         // Wait a bit before checking again
  710 |         await page.waitForTimeout(3000);
  711 |       }
  712 |       
  713 |       // If we have a reportId from the API response but weren't redirected, force navigation
  714 |       if (!redirectSuccess && generatedReportId) {
  715 |         console.log(`Polling timed out, but we have reportId ${generatedReportId}. Forcing navigation...`);
  716 |         await page.goto(`${APP_URL}/reports/${generatedReportId}`);
  717 |         await page.waitForTimeout(2000);
  718 |       }
  719 |       // If we still don't have a report URL, try to navigate to the reports page
  720 |       else if (!redirectSuccess) {
  721 |         console.log("Direct navigation didn't work. Trying to navigate to the reports page...");
  722 |         
  723 |         // Navigate to the reports list
  724 |         await page.goto(`${APP_URL}/reports`);
  725 |         
  726 |         // Wait for page to load
  727 |         await page.waitForTimeout(2000);
  728 |         
  729 |         // Take a screenshot of the reports page
  730 |         await page.screenshot({ path: 'reports-list-page.png' });
  731 |         
  732 |         // Click on the first report (which should be the latest one)
  733 |         const reportLinks = await page.locator('a[href^="/reports/"]').all();
  734 |         if (reportLinks.length > 0) {
  735 |           console.log(`Found ${reportLinks.length} reports, clicking on the first one...`);
  736 |           await reportLinks[0].click();
  737 |           await page.waitForTimeout(2000);
  738 |         } else {
  739 |           console.error("No reports found to click on!");
  740 |           
  741 |           // Last resort - try refreshing the page and checking again
  742 |           await page.reload();
  743 |           await page.waitForTimeout(3000);
  744 |           
  745 |           const reportsAfterReload = await page.locator('a[href^="/reports/"]').all();
  746 |           if (reportsAfterReload.length > 0) {
  747 |             console.log(`Found ${reportsAfterReload.length} reports after reload, clicking first one...`);
  748 |             await reportsAfterReload[0].click();
  749 |           }
  750 |         }
  751 |       }
  752 |     });
  753 |
  754 |     // Step 3 & 4: Verify report creation and content
  755 |     await test.step('Validate report creation and content integrity', async () => {
  756 |       // Verify we're now on a report page
  757 |       const currentUrl = page.url();
  758 |       console.log(`Current URL: ${currentUrl}`);
  759 |       
  760 |       // Make this assertion more forgiving for local development
  761 |       if (!currentUrl.match(new RegExp(`${APP_URL}/reports/\\d+$`))) {
  762 |         console.error(`Expected URL to match ${APP_URL}/reports/ID pattern, but got: ${currentUrl}`);
  763 |         
  764 |         // Take a screenshot for debugging
  765 |         await page.screenshot({ path: 'report-page-error.png' });
  766 |         
  767 |         // Try to navigate to reports directly one more time
  768 |         await page.goto(`${APP_URL}/reports`);
  769 |         await page.waitForTimeout(2000);
  770 |         
  771 |         const reportLinks = await page.locator('a[href^="/reports/"]').all();
  772 |         if (reportLinks.length > 0) {
  773 |           await reportLinks[0].click();
  774 |           await page.waitForTimeout(2000);
  775 |         }
  776 |       }
  777 |       
  778 |       // Updated expectation with a more descriptive error message if it fails
  779 |       await expect(page.url(), 
  780 |         'Expected to be redirected to a report page URL. Check that report generation is working correctly.'
  781 |       ).toMatch(new RegExp(`${APP_URL}/reports/\\d+$`));
  782 |       
  783 |       // Verify report header 
> 784 |       await expect(page.getByRole('heading', { name: testAssessment.basics.reportName, exact: false })).toBeVisible();
      |                                                                                                         ^ Error: Timed out 5000ms waiting for expect(locator).toBeVisible()
  785 |       
  786 |       // Verify company info
  787 |       await expect(page.getByText(testAssessment.basics.companyName)).toBeVisible();
  788 |       await expect(page.getByText(testAssessment.basics.industry)).toBeVisible();
  789 |       
  790 |       // Verify AI Adoption Score is calculated and visible
  791 |       await expect(page.getByTestId('ai-adoption-score')).toBeVisible();
  792 |       
  793 |       // Verify opportunities section
  794 |       await expect(page.getByText(/Transformation Opportunities/i)).toBeVisible();
  795 |       
  796 |       // Verify at least one role from assessment is mentioned
  797 |       for (const role of testAssessment.roles) {
  798 |         const roleVisible = await page.getByText(role.title).isVisible();
  799 |         if (roleVisible) {
  800 |           // If we found at least one role, we're good
  801 |           expect(roleVisible).toBeTruthy();
  802 |           break;
  803 |         }
  804 |       }
  805 |       
  806 |       // Verify ROI information is present
  807 |       await page.getByRole('tab', { name: /ai adoption score/i }).click();
  808 |       await expect(page.getByText(/ROI Analysis/i)).toBeVisible();
  809 |       
  810 |       // Verify the AI adoption score inputs are reflected in the report
  811 |       await expect(page.getByText(`${testAssessment.aiAdoptionScoreInputs.adoptionRateForecast}%`, { exact: false })).toBeVisible();
  812 |       await expect(page.getByText('$500,000', { exact: false })).toBeVisible(); // Cost efficiency gains
  813 |       
  814 |       // Check roadmap tab
  815 |       await page.getByRole('tab', { name: /roadmap/i }).click();
  816 |       await expect(page.getByText(/Implementation Timeline/i)).toBeVisible();
  817 |       
  818 |       // Verify pre-sales specific recommendations (case study specific)
  819 |       const preRoleFound = await page.getByText(/Pre-Sales/i).isVisible() || 
  820 |                           await page.getByText(/automation/i).isVisible() || 
  821 |                           await page.getByText(/knowledge base/i).isVisible();
  822 |       expect(preRoleFound).toBeTruthy();
  823 |     });
  824 |
  825 |     // Step 5: Verify persistent access
  826 |     await test.step('Ensure report persistence and accessibility', async () => {
  827 |       // Record the report URL
  828 |       const reportUrl = page.url();
  829 |       const reportId = reportUrl.split('/').pop();
  830 |       
  831 |       // Navigate to dashboard
  832 |       await page.goto(`${APP_URL}/dashboard`);
  833 |       
  834 |       // Verify reports list
  835 |       await page.getByText(/reports/i).click();
  836 |       await expect(page.getByText(testAssessment.basics.reportName)).toBeVisible();
  837 |       
  838 |       // Navigate back to report via the list
  839 |       await page.getByText(testAssessment.basics.reportName).click();
  840 |       await expect(page.url()).toBe(reportUrl);
  841 |       
  842 |       // Verify content is still accessible
  843 |       await expect(page.getByRole('heading', { name: testAssessment.basics.reportName, exact: false })).toBeVisible();
  844 |       
  845 |       // Verify we can access the original assessment
  846 |       await page.goto(`${APP_URL}/dashboard`);
  847 |       await page.getByText(/assessments/i).click();
  848 |       await expect(page.getByText(testAssessment.basics.reportName)).toBeVisible();
  849 |     });
  850 |   });
  851 | });
  852 |
```